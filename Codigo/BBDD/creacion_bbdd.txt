-- Crear la base de datos
CREATE DATABASE IF NOT EXISTS sistema_riego;

-- Usar la base de datos recién creada
USE sistema_riego;

-- Tabla de usuarios
CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100),
    apellidos VARCHAR(100),
    email VARCHAR(100),
    password VARCHAR(255), -- Ampliado el límite de longitud de la contraseña
    direccion VARCHAR(255),
    telefono VARCHAR(20),
    CONSTRAINT unique_email UNIQUE (email) -- Restricción de clave única para el campo email
);

-- Tabla de arduino
CREATE TABLE IF NOT EXISTS arduino (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ip VARCHAR(50),
    id_user INT,
    FOREIGN KEY (id_user) REFERENCES users(id)
);

-- Tabla de datos de sensores
CREATE TABLE IF NOT EXISTS datos_sensores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    temperatura DECIMAL(5,2),
    humedad DECIMAL(5,2),
    humedad_suelo DECIMAL(5,2),
    fecha_hora DATETIME,
    id_ard INT,
    FOREIGN KEY (id_ard) REFERENCES arduino(id)
);

-- Tabla de registros de riego
CREATE TABLE IF NOT EXISTS registros_riego (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_user INT,
    id_ard INT,
    fecha_hora DATETIME,
    duracion_segundos INT,
    FOREIGN KEY (id_user) REFERENCES users(id),
    FOREIGN KEY (id_ard) REFERENCES arduino(id)
);

-- Crear índice para mejorar el rendimiento de consultas frecuentes
CREATE INDEX idx_id_user ON arduino(id_user);
